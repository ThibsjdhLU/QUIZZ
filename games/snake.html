<!doctype html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Snake</title>
    <meta name="description" content="Jeu du serpent (Snake)" />
    <link rel="icon" href="../assets/favicon.svg">
    <link rel="stylesheet" href="../assets/site.css">
    <style>
      :root { color-scheme: light dark; }
      * { box-sizing: border-box; }
      body { margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, 'Helvetica Neue', Arial, 'Noto Sans', 'Apple Color Emoji', 'Segoe UI Emoji', sans-serif; }
      header { display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid currentColor; }
      header a { text-decoration: none; color: inherit; }
      main { max-width: 720px; margin: 0 auto; padding: 1.25rem 1rem 3rem; }
      h1 { margin: 0; font-size: clamp(22px, 4vw, 32px); }
      .panel { margin-top: 1rem; display: grid; grid-template-columns: 1fr; justify-items: center; gap: 12px; }
      canvas { border: 1px solid currentColor; border-radius: 12px; background: color-mix(in oklab, currentColor 6%, transparent); touch-action: none; }
      .info { display: flex; gap: 16px; flex-wrap: wrap; opacity: 0.95; }
      .badge { padding: 0.35rem 0.6rem; border: 1px solid currentColor; border-radius: 999px; }
      .controls { display: flex; gap: 12px; }
      button { font: inherit; padding: 0.5rem 0.9rem; border: 1px solid currentColor; background: transparent; border-radius: 10px; cursor: pointer; }
    </style>
  </head>
  <body>
    <header class="site">
      <div class="left"><a class="btn ghost" href="../index.html">‚Üê Accueil</a></div>
      <h1>üêç Snake</h1>
      <div class="right"><button id="theme-toggle" class="theme-toggle" aria-label="Changer de th√®me">üåô</button></div>
    </header>
    <main class="container">
      <div class="ad-wrap" aria-label="Publicit√©">
        <small class="ad-label">Publicit√©</small>
        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-XXXXXXXXXXXXXXXX" data-ad-slot="5000000001" data-ad-format="auto" data-full-width-responsive="true"></ins>
      </div>
      <div class="info">
        <div class="badge">Score: <span id="score">0</span></div>
        <div class="badge">Record: <span id="best">0</span></div>
        <div class="badge">Vitesse: <span id="speed">1x</span></div>
      </div>
      <div class="panel">
        <canvas id="c" width="420" height="420" aria-label="Plateau du jeu"></canvas>
        <div class="controls">
          <button id="start">D√©marrer</button>
          <button id="restart">Rejouer</button>
        </div>
      </div>
      <div class="ad-wrap" aria-label="Publicit√©">
        <small class="ad-label">Publicit√©</small>
        <ins class="adsbygoogle" style="display:block" data-ad-client="ca-pub-XXXXXXXXXXXXXXXX" data-ad-slot="5000000002" data-ad-format="auto" data-full-width-responsive="true"></ins>
      </div>
    </main>
    <script defer src="../assets/config.js"></script>
    <script defer src="../assets/site.js"></script>
    <script>
      (function(){
        const canvas = document.getElementById('c');
        const ctx = canvas.getContext('2d');
        const scoreEl = document.getElementById('score');
        const bestEl = document.getElementById('best');
        const speedEl = document.getElementById('speed');
        const startBtn = document.getElementById('start');
        const restartBtn = document.getElementById('restart');

        const SIZE = 20; // taille d'une case
        const GRID = canvas.width / SIZE; // 21x21
        let snake, dir, food, score, best, loop, speed;

        const storage = window.SafeStorage || window.localStorage;
        try { best = +storage.getItem('snake_best') || 0; } catch(e){ best = 0; }
        bestEl.textContent = best;

        function rndCell(){ return { x: Math.floor(Math.random()*GRID), y: Math.floor(Math.random()*GRID) }; }
        function placeFood(){
          do { food = rndCell(); } while (snake.some(s => s.x===food.x && s.y===food.y));
        }

        function init(){
          snake = [{x:10,y:10},{x:9,y:10},{x:8,y:10}];
          dir = {x:1,y:0};
          speed = 1; speedEl.textContent = '1x';
          score = 0; scoreEl.textContent = score;
          placeFood();
          draw();
        }

        function draw(){
          ctx.clearRect(0,0,canvas.width, canvas.height);
          // food
          ctx.fillStyle = 'crimson';
          ctx.fillRect(food.x*SIZE, food.y*SIZE, SIZE, SIZE);
          // snake
          ctx.fillStyle = 'currentColor';
          snake.forEach((s,i)=>{
            ctx.globalAlpha = 1 - i*0.02; // l√©g√®re att√©nuation
            ctx.fillRect(s.x*SIZE, s.y*SIZE, SIZE, SIZE);
          });
          ctx.globalAlpha = 1;
        }

        function tick(){
          const head = { x: snake[0].x + dir.x, y: snake[0].y + dir.y };
          // collisions mur
          if(head.x < 0 || head.y < 0 || head.x >= GRID || head.y >= GRID) return gameOver();
          // collisions soi‚Äëm√™me
          if(snake.some(s => s.x===head.x && s.y===head.y)) return gameOver();
          snake.unshift(head);
          // manger
          if(head.x===food.x && head.y===food.y){
            score++; scoreEl.textContent = score;
            if(score%5===0 && speed<4){ speed++; speedEl.textContent = speed+'x'; startLoop(); }
            placeFood();
          } else {
            snake.pop();
          }
          draw();
        }

        function startLoop(){ clearInterval(loop); loop = setInterval(tick, 150/Math.pow(1.25, speed-1)); }
        function stopLoop(){ clearInterval(loop); }

        function gameOver(){
          stopLoop();
          if(score>best){ best = score; try { storage.setItem('snake_best', String(best)); } catch(e){} bestEl.textContent = best; }
          ctx.save();
          ctx.fillStyle = 'rgba(0,0,0,0.35)';
          ctx.fillRect(0,0,canvas.width,canvas.height);
          ctx.restore();
        }

        // Controls clavier
        window.addEventListener('keydown', (e)=>{
          const k = e.key.toLowerCase();
          if(k==='arrowup' || k==='w'){ if(dir.y!==1){ dir={x:0,y:-1}; } }
          else if(k==='arrowdown' || k==='s'){ if(dir.y!==-1){ dir={x:0,y:1}; } }
          else if(k==='arrowleft' || k==='a'){ if(dir.x!==1){ dir={x:-1,y:0}; } }
          else if(k==='arrowright' || k==='d'){ if(dir.x!==-1){ dir={x:1,y:0}; } }
        });

        // Touch (mobile)
        let touchStart;
        canvas.addEventListener('touchstart', (e)=>{ touchStart = e.touches[0]; });
        canvas.addEventListener('touchmove', (e)=>{ e.preventDefault(); }, { passive:false });
        canvas.addEventListener('touchend', (e)=>{
          if(!touchStart) return;
          const t = e.changedTouches[0];
          const dx = t.clientX - touchStart.clientX;
          const dy = t.clientY - touchStart.clientY;
          if(Math.abs(dx)>Math.abs(dy)){
            if(dx>0 && dir.x!==-1) dir={x:1,y:0};
            else if(dx<0 && dir.x!==1) dir={x:-1,y:0};
          } else {
            if(dy>0 && dir.y!==-1) dir={x:0,y:1};
            else if(dy<0 && dir.y!==1) dir={x:0,y:-1};
          }
          touchStart = null;
        });

        startBtn.addEventListener('click', ()=>{ init(); startLoop(); });
        restartBtn.addEventListener('click', ()=>{ init(); startLoop(); });

        init();
      })();
    </script>
  </body>
  
</html>
